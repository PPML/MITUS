---
title: "Targeted Testing And Treatment" 
author: "Nicole A. B. Swartwood"
date: "`r Sys.Date()`"
output: rmarkdown::pdf_document
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

MITUS has the ability to model additional screening and treatment for Latent TB Infection (LTBI) through the design and implementation of Targeted Testing and Treatment Scenarios. Below we describe the baseline LTBI testing and treatment cascade in MITUS, followed by a walk through of TTT in the model, with an example. 

For baseline screening, MITUS assumes a baseline screening rate of approximately ~.004. 
```{r, warning=FALSE, message=FALSE,echo=FALSE, fig.width=7.5, fig.height=6.5}
library(MITUS)
model_load()
Par<-readRDS("~/MITUS/inst/US/US_Param_all_10_1031.rds")
params<-fin2_param_init(Par[3,], loc = "US", prg_chng=def_prgchng(Par[3,]), ttt_list=def_ttt())
params$rLtScrt[((2020-1949)*12)+1]
```
The rate of screening is modified for high-risk populations and populations without latent TB. 
```{r, warning=FALSE, message=FALSE,echo=FALSE, fig.width=7.5, fig.height=6.5}
library(MITUS)
model_load()
Par<-readRDS("~/MITUS/inst/US/US_Param_all_10_1031.rds")
paste0("rate ratio of screening for high risk population",Par[3,"rrTestHr"])
paste0("rate ratio of screening for low risk, no tb population",Par[3,"rrTestLrNoTb"])
```
Sensitivity and specificity are calculated based on the Shaw paper. They are specific to the nativity, risk group, and in one case, age of the population being screened. 
```{r, warning=FALSE, message=FALSE,echo=FALSE, fig.width=7.5, fig.height=6.5}
library(MITUS)
model_load()
Par<-readRDS("~/MITUS/inst/US/US_Param_all_10_1031.rds")
params<-fin2_param_init(Par[3,], loc = "US", prg_chng=def_prgchng(Par[3,]), ttt_list=def_ttt())
print("Sensitivities are: ")
params$LtDxPar_lt[,((2020-1949)*12)+1]
print("Specificities are: ")
1-params$LtDxPar_nolt[,((2020-1949)*12)+1]
```
Baseline screening in MITUS is calculated as the product of the above values, summing the cases identified among those whose true status is LTBI+ and those whose true status is LTBI-:    
$$ ((N_{Lf}+N_{Ls})*rate_{scrn}*RR_{scrn}*Sens) + ((N_{Su}+N_{Sp})*rate_{scrn}*RR_{scrn}*(1-Spec))$$ 

For additional screening for TTT we first calculate a matrix of sampling probabilities for each intersection of the TB reactivation risk stratum and the mortality risk stratum. 
```{r, warning=FALSE, message=FALSE,echo=FALSE, fig.width=7.5, fig.height=6.5}
library(MITUS)
model_load()
Par<-readRDS("~/MITUS/inst/US/US_Param_all_10_1031.rds")
params2<-fin2_param_init(Par[3,], loc = "US", prg_chng=def_prgchng(Par[3,]), ttt_list=risk_pop_setup()[[1]])
print("For example, calculating these probabilities for 1.1 million individuals with HIV: ")
params2$ttt_sampling_dist
```

These probabilities are then applied to the latent fast and latent slow compartments to determine the total number of screened, that are LTBI+. 

The product, $N_{scrn}$ , is then multiplied by the specificity sensitivity for the population.  




