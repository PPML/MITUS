#'This function is used to run a optimization on the input parameters.
#' when there is no rebalancing in the model.
#'It will return 7 datasets of the optimized parameters --one from each
#'optimization step.
#'The function requires the use of the ParamInit Rdata file and the
#'StartValues Rdata file.
#'@name optim_ag
#'@param df dataframe or matrix of starting values data frame
#'@param samp_i which rows of the data frame to use
#'@return 7 datasets from optimization loop
#'@export
optim_ag <- function(df, samp_i=1){
  # if (loc=="US"){
    posterior = function(theta) {

      -lprior(theta) - llikelihood_ag(theta,n_cores)

    }

    if(min(dim(as.data.frame(df)))==1) {
      df1 <- as.numeric(df)
      names(df1) <- names(df)
    } else{
      df1 <- as.numeric(df[samp_i,])
    }

    b<-samp_i
    # for (i in min(b, nrow(StartVal))){
    o1  <- optim(df1, posterior, method ="BFGS", control=list(maxit=400,trace=5,reltol=sqrt(.Machine$double.eps)/5)) ; o1$value
    save(o1,file=paste("Opt_US_r1_noRB_", b,"_", Sys.Date(),".rda",sep=""))
    o2  <- optim(o1$par,posterior, method ="Nelder-Mead", control=list(maxit=1000,trace=1,reltol=sqrt(.Machine$double.eps)/5));  o2$value
    save(o2,file=paste("Opt_US_r2_noRB_", b,"_", Sys.Date(),".rda",sep=""))
    o3  <- optim(o2$par, posterior, method ="BFGS", control=list(maxit=400,trace=5,reltol=sqrt(.Machine$double.eps)/5)) ; o3$value
    save(o3,file=paste("Opt_US_r3_noRB_", b,"_", Sys.Date(),".rda",sep=""))
    o4  <- optim(o3$par ,posterior, method ="Nelder-Mead", control=list(maxit=1000,trace=1,reltol=sqrt(.Machine$double.eps)/5));  o4$value
    save(o4,file=paste("Opt_US_r4_noRB_", b,"_", Sys.Date(),".rda",sep=""))
    o5  <- optim(o4$par, posterior, method ="BFGS", control=list(maxit=400,trace=5,reltol=sqrt(.Machine$double.eps)/5)) ; o5$value
    save(o5,file=paste("Opt_US_r5_noRB_", b,"_", Sys.Date(),".rda",sep=""))
    o6  <- optim(o5$par ,posterior, method ="Nelder-Mead", control=list(maxit=1000,trace=1,reltol=sqrt(.Machine$double.eps)/5));  o6$value
    save(o6,file=paste("Opt_US_r6_noRB_", b,"_", Sys.Date(),".rda",sep=""))
    o7  <- optim(o6$par, posterior, method ="BFGS", control=list(maxit=400,trace=5,reltol=sqrt(.Machine$double.eps)/5)) ; o7$value
    save(o7,file=paste("Opt_US_r7_noRB_", b,"_", Sys.Date(),".rda",sep=""))
    # }
  # } else {
  #
  #   posterior_st = function(theta) {
  #     -lprior(theta) - llikelihood_noRB(theta,loc,n_cores)
  #   }
  #
  #   if(min(dim(as.data.frame(df)))==1) {
  #     df1 <- as.numeric(df)
  #     names(df1) <- names(df)
  #   } else{
  #     df1 <- as.numeric(df[samp_i,])
  #   }
  #
  #   b<-samp_i
  #   # for (i in min(b, nrow(StartVal))){
  #   o1  <- optim(df1, posterior_st, method ="BFGS", control=list(maxit=400,trace=5,reltol=sqrt(.Machine$double.eps)/5)) ; o1$value
  #   save(o1,file=paste("Opt_",loc,"_r1_", b,"_", Sys.Date(),".rda",sep=""))
  #   o2  <- optim(o1$par,posterior_st, method ="Nelder-Mead", control=list(maxit=1000,trace=1,reltol=sqrt(.Machine$double.eps)/5));  o2$value
  #   save(o2,file=paste("Opt_",loc,"_r2_", b,"_", Sys.Date(),".rda",sep=""))
  #   o3  <- optim(o2$par, posterior_st, method ="BFGS", control=list(maxit=400,trace=5,reltol=sqrt(.Machine$double.eps)/5)) ; o3$value
  #   save(o3,file=paste("Opt_",loc,"_r3_", b,"_", Sys.Date(),".rda",sep=""))
  #   o4  <- optim(o3$par ,posterior_st, method ="Nelder-Mead", control=list(maxit=1000,trace=1,reltol=sqrt(.Machine$double.eps)/5));  o4$value
  #   save(o4,file=paste("Opt_",loc,"_r4_", b,"_", Sys.Date(),".rda",sep=""))
  #   o5  <- optim(o4$par, posterior_st, method ="BFGS", control=list(maxit=400,trace=5,reltol=sqrt(.Machine$double.eps)/5)) ; o5$value
  #   save(o5,file=paste("Opt_",loc,"_r5_", b,"_", Sys.Date(),".rda",sep=""))
  #   o6  <- optim(o5$par ,posterior_st, method ="Nelder-Mead", control=list(maxit=1000,trace=1,reltol=sqrt(.Machine$double.eps)/5));  o6$value
  #   save(o6,file=paste("Opt_",loc,"_r6_", b,"_", Sys.Date(),".rda",sep=""))
  #   o7  <- optim(o6$par, posterior_st, method ="BFGS", control=list(maxit=400,trace=5,reltol=sqrt(.Machine$double.eps)/5)) ; o7$value
  #   save(o7,file=paste("Opt_",loc,"_r7_", b,"_", Sys.Date(),".rda",sep=""))
  # }

}
